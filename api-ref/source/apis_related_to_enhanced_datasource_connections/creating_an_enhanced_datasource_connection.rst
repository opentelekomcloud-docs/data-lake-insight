:original_name: dli_02_0187.html

.. _dli_02_0187:

Creating an Enhanced Datasource Connection
==========================================

Function
--------

This API is used to create an enhanced datasource connection with other services.

URI
---

-  URI format

   POST /v2.0/{project_id}/datasource/enhanced-connections

-  Parameter description

   .. table:: **Table 1** URI parameter

      +------------+-----------+--------+-----------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter  | Mandatory | Type   | Description                                                                                                                                   |
      +============+===========+========+===============================================================================================================================================+
      | project_id | Yes       | String | Project ID, which is used for resource isolation. For details about how to obtain its value, see :ref:`Obtaining a Project ID <dli_02_0183>`. |
      +------------+-----------+--------+-----------------------------------------------------------------------------------------------------------------------------------------------+

Request Parameters
------------------

.. table:: **Table 2** Request parameters

   +-----------------+-----------------+------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory       | Type             | Description                                                                                                                                                       |
   +=================+=================+==================+===================================================================================================================================================================+
   | name            | Yes             | String           | Name of the connection.                                                                                                                                           |
   |                 |                 |                  |                                                                                                                                                                   |
   |                 |                 |                  | -  The name can contain only letters, digits, and underscores (_), and cannot be left empty.                                                                      |
   |                 |                 |                  | -  A maximum of 64 characters are allowed.                                                                                                                        |
   +-----------------+-----------------+------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | dest_vpc_id     | Yes             | String           | The ID of the service VPC to be connected.                                                                                                                        |
   +-----------------+-----------------+------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | dest_network_id | Yes             | String           | The subnet ID of the to-be-connected service.                                                                                                                     |
   +-----------------+-----------------+------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | queues          | No              | Array of Strings | List of queue names that are available for datasource connections.                                                                                                |
   +-----------------+-----------------+------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | routetable_id   | No              | String           | Route table associated with the subnet of the service.                                                                                                            |
   +-----------------+-----------------+------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | hosts           | No              | Array of objects | The user-defined host information. A maximum of 20,000 records are supported. For details, see :ref:`hosts request parameters <dli_02_0187__table6991727151310>`. |
   +-----------------+-----------------+------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | tags            | No              | Array of objects | Tags of datasource connections. For details, see :ref:`Table 4 <dli_02_0187__table9391124139>`.                                                                   |
   +-----------------+-----------------+------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _dli_02_0187__table6991727151310:

.. table:: **Table 3** hosts request parameters

   +-----------+-----------+--------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter | Mandatory | Type   | Description                                                                                                                                                                 |
   +===========+===========+========+=============================================================================================================================================================================+
   | name      | No        | String | The user-defined host name. The value can consist of 128 characters, including digits, letters, underscores (_), hyphens (-), and periods (.). It must start with a letter. |
   +-----------+-----------+--------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | ip        | No        | String | The IPv4 address of the host.                                                                                                                                               |
   +-----------+-----------+--------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _dli_02_0187__table9391124139:

.. table:: **Table 4** tags parameter

   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory       | Type            | Description                                                                                                                                                                                                     |
   +=================+=================+=================+=================================================================================================================================================================================================================+
   | key             | Yes             | String          | Tag key.                                                                                                                                                                                                        |
   |                 |                 |                 |                                                                                                                                                                                                                 |
   |                 |                 |                 | .. note::                                                                                                                                                                                                       |
   |                 |                 |                 |                                                                                                                                                                                                                 |
   |                 |                 |                 |    A tag key can contain a maximum of 128 characters. Only letters, numbers, spaces, and special characters ``(_.:+-@)`` are allowed, but the value cannot start or end with a space or start with **\_sys\_**. |
   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | value           | Yes             | String          | Tag key.                                                                                                                                                                                                        |
   |                 |                 |                 |                                                                                                                                                                                                                 |
   |                 |                 |                 | .. note::                                                                                                                                                                                                       |
   |                 |                 |                 |                                                                                                                                                                                                                 |
   |                 |                 |                 |    A tag value can contain a maximum of 255 characters. Only letters, numbers, spaces, and special characters ``(_.:+-@)`` are allowed.                                                                         |
   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Response Parameters
-------------------

.. table:: **Table 5** Response parameters

   +---------------+---------+-----------------------------------------------------------------------------------------------------------------------------+
   | Parameter     | Type    | Description                                                                                                                 |
   +===============+=========+=============================================================================================================================+
   | is_success    | Boolean | Indicates whether the request is successfully executed. Value **true** indicates that the request is successfully executed. |
   +---------------+---------+-----------------------------------------------------------------------------------------------------------------------------+
   | message       | String  | System prompt. If execution succeeds, the message may be left blank.                                                        |
   +---------------+---------+-----------------------------------------------------------------------------------------------------------------------------+
   | connection_id | String  | Connection ID. Identifies the UUID of a datasource connection.                                                              |
   +---------------+---------+-----------------------------------------------------------------------------------------------------------------------------+

Example Request
---------------

Create an enhanced datasource connection for a queue and configure host information.

.. code-block::

   {
     "name": "test",
     "dest_vpc_id": "22094d8f-c310-4621-913d-4c4d655d8495",
     "dest_network_id": "78f2562a-36e4-4b39-95b9-f5aab22e1281",
     "queues": [
       "q1",
       "q2"
     ],
     "hosts": [
       {
         "ip":"192.168.0.1",
         "name":"ecs-97f8-0001"
       },
       {
         "ip":"192.168.0.2",
         "name":"ecs-97f8-0002"
       }
     ]
   }

Example Response
----------------

.. code-block::

   {
     "is_success": true,
     "message": "Create peer connection for queues:{Queue list in the request parameter}",
     "connection_id": "2a620c33-5609-40c9-affd-2b6453071b0f"
   }

Status Codes
------------

:ref:`Table 6 <dli_02_0187__tb12870f1c5f24b27abd55ca24264af36>` describes the status code.

.. _dli_02_0187__tb12870f1c5f24b27abd55ca24264af36:

.. table:: **Table 6** Status codes

   =========== ================================
   Status Code Description
   =========== ================================
   201         The job is created successfully.
   400         Request error.
   500         Internal service error.
   =========== ================================

Error Codes
-----------

If an error occurs when this API is invoked, the system does not return the result similar to the preceding example, but returns the error code and error information. For details, see :ref:`Error Codes <dli_02_0056>`.
