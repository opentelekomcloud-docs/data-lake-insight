:original_name: dli_01_0017.html

.. _dli_01_0017:

SQL Job Management
==================

SQL jobs allow you to execute SQL statements entered in the :ref:`SQL job editing window <dli_01_0320>`, import data, and export data.

SQL job management provides the following functions:

-  :ref:`Searching for Jobs <dli_01_0017__section71552447166>`: Search for jobs that meet the search criteria.
-  :ref:`Viewing Job Details <dli_01_0017__section1960402414173>`: Display job details.
-  :ref:`Terminating a Job <dli_01_0017__section8647175812179>`: Stop a job in the **Submitting** or **Running** status.
-  :ref:`Exporting Query Results <dli_01_0017__section1152211221244>`: A maximum of 1000 records can be displayed in the query result on the console. To view more or all data, you can export the data to OBS.

SQL Jobs Page
-------------

On the **Overview** page of the DLI console, click **SQL Jobs** to go to the SQL job management page. Alternatively, you can click **Job Management** > **SQL Jobs**. The job list displays all SQL jobs. If there are a large number of jobs, they will be displayed on multiple pages. You can switch to the specified page as needed. DLI allows you to view jobs in all statuses. By default, jobs in the job list are displayed in descending order of the job creation time.

.. table:: **Table 1** SQL Job management parameters

   +-----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter                         | Description                                                                                                                                                                                                                                                                                                                                                                                                                                       |
   +===================================+===================================================================================================================================================================================================================================================================================================================================================================================================================================================+
   | Queues                            | Name of the queue to which a job belongs                                                                                                                                                                                                                                                                                                                                                                                                          |
   +-----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Username                          | Name of the user who executed the job.                                                                                                                                                                                                                                                                                                                                                                                                            |
   +-----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Type                              | Job type. The following types are supported:                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                                   | -  **IMPORT**: A job that imports data to DLI                                                                                                                                                                                                                                                                                                                                                                                                     |
   |                                   | -  **EXPORT**: A job that exports data from DLI                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                                   | -  **DCL**: Conventional DCLs and operations related to queue permissions                                                                                                                                                                                                                                                                                                                                                                         |
   |                                   | -  **DDL**:Conventional DDLs, including creating and deleting databases and tables                                                                                                                                                                                                                                                                                                                                                                |
   |                                   | -  **QUERY**: A job that querys data by running SQL statements                                                                                                                                                                                                                                                                                                                                                                                    |
   |                                   | -  **INSERT**: A job that inserts data by running SQL statements                                                                                                                                                                                                                                                                                                                                                                                  |
   |                                   | -  **UPDATE**: A job that updates data.                                                                                                                                                                                                                                                                                                                                                                                                           |
   |                                   | -  **DELETE**: A job that deletes a SQL job.                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   | -  **DATA_MIGRATION**: A job that migrates data.                                                                                                                                                                                                                                                                                                                                                                                                  |
   |                                   | -  **RESTART_QUEUE**: A job that restarts a queue.                                                                                                                                                                                                                                                                                                                                                                                                |
   |                                   | -  **SCALE_QUEUE**: A job that changes queue specifications, including sale-out and scale-in.                                                                                                                                                                                                                                                                                                                                                     |
   +-----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Status                            | Job status. Possible values are as follows:                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                                   | -  **Submitting**                                                                                                                                                                                                                                                                                                                                                                                                                                 |
   |                                   | -  **Running**                                                                                                                                                                                                                                                                                                                                                                                                                                    |
   |                                   | -  **Finished**                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                                   | -  **Canceled**                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                                   | -  **Failed**                                                                                                                                                                                                                                                                                                                                                                                                                                     |
   |                                   | -  **Scaling**                                                                                                                                                                                                                                                                                                                                                                                                                                    |
   +-----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Query                             | SQL statements for operations such as exporting and creating tables                                                                                                                                                                                                                                                                                                                                                                               |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                                   | You can click |image1| to copy the query statement.                                                                                                                                                                                                                                                                                                                                                                                               |
   +-----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Duration                          | Running duration of a job                                                                                                                                                                                                                                                                                                                                                                                                                         |
   +-----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Created                           | Time when a job is created. Jobs can be displayed in ascending or descending order of the job creation time.                                                                                                                                                                                                                                                                                                                                      |
   +-----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Operation                         | -  **Edit**: Edit the job.                                                                                                                                                                                                                                                                                                                                                                                                                        |
   |                                   | -  **Cancel**                                                                                                                                                                                                                                                                                                                                                                                                                                     |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                                   |    -  You can terminate a job only when the job is in **Submitting** or **Running** status.                                                                                                                                                                                                                                                                                                                                                       |
   |                                   |    -  A job whose status is **Finished**, **Failed**, or **Canceled** cannot be terminated.                                                                                                                                                                                                                                                                                                                                                       |
   |                                   |    -  If the **Cancel** button is gray, you are not allowed to perform this operation.                                                                                                                                                                                                                                                                                                                                                            |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                                   | -  **Re-execute**: Execute the job again.                                                                                                                                                                                                                                                                                                                                                                                                         |
   |                                   | -  **SparkUI**: Display the Spark job execution page.                                                                                                                                                                                                                                                                                                                                                                                             |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                                   |    .. note::                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                                   |       -  When you execute a job on a created queue, the cluster is restarted. It takes about 10 minutes. If you click **SparkUI** before the cluster is created, an empty **projectID** will be cached. The SparkUI page cannot be displayed. You are advised to use a dedicated queue so that the cluster will not be released. Alternatively, wait for a while after the job is submitted (the cluster is created), and then check **SparkUI**. |
   |                                   |       -  Currently, only the latest 100 job information records are displayed on the SparkUI of DLI.                                                                                                                                                                                                                                                                                                                                              |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                                   | -  In addition to the preceding operations, the following operations are available for QUERY jobs and asynchronous DDL jobs.                                                                                                                                                                                                                                                                                                                      |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                                   |    -  **View Result**: View the job running result.                                                                                                                                                                                                                                                                                                                                                                                               |
   |                                   |    -  **Export Result**: Export the job running result to the created OBS bucket. For details, see :ref:`Exporting Query Results <dli_01_0017__section1152211221244>`.                                                                                                                                                                                                                                                                            |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                                   | -  In addition to the preceding operations, the EXPORT job also includes the following operations:                                                                                                                                                                                                                                                                                                                                                |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                                   |    -  **Download**                                                                                                                                                                                                                                                                                                                                                                                                                                |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                                   | -  **View Log**: Save job logs to the temporary OBS bucket created by DLI.                                                                                                                                                                                                                                                                                                                                                                        |
   |                                   | -  **Export Log**: Export logs to the created OBS bucket. If the job is in the **Running** state, logs cannot be exported.                                                                                                                                                                                                                                                                                                                        |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                                   | .. note::                                                                                                                                                                                                                                                                                                                                                                                                                                         |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                                   |    To export the logs, you need to obtain the permission to create an OBS bucket.                                                                                                                                                                                                                                                                                                                                                                 |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                                   |    Log archiving and export are not available for synchronization jobs and jobs running on the default queue.                                                                                                                                                                                                                                                                                                                                     |
   +-----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _dli_01_0017__section71552447166:

Searching for a Job
-------------------

On the **SQL Jobs** page, you can search jobs with any of the following operations.

-  Select a queue name.
-  Set the date range.
-  Enter a username, statement, or job ID.
-  Select the creation time in ascending or descending order.
-  Select a job type.
-  Select a job status.
-  Select the job execution duration in ascending or descending order.

.. _dli_01_0017__section1960402414173:

Viewing Job Details
-------------------

On the **SQL Jobs** page, you can click |image2| in front of a job record to view details about the job.

Job details vary with job types. The job details vary depending on the job types, status, and configuration options. The following describes how to load data, create a table, and select a job. For details about other job types, see the information on the management console.

-  **Load data** (job type: IMPORT) include the following information: queue, job ID, username, type, status, execution statement, running duration, creation time, end time, parameter settings, label, number of results, scanned data, number of scanned data, number of error records, storage path, data format, database, table, table header, separator, reference character, escape character, date format, timestamp format, total CPU used, and output bytes.
-  **Create table** (job type: DDL) include the following information: queue, job ID, username, type, status, execution statement, running duration, creation time, end time, parameter settings, tags, number of results, scanned data, and database.
-  **Select** (job type: QUERY) include the following information: queue, job ID, username, type, status, execution statement, running duration, creation time, end time, parameter setting, label, number of results (results of successful executions can be exported), and scanned data, username, result status (results of successful tasks can be viewed. Failure causes of failed tasks are displayed), database, total CPU used, and output bytes.

   .. note::

      -  **Total CPU Used (Core x ms)**: total CPU used during job execution.
      -  **Output Bytes**: number of output bytes after the job is executed.

.. _dli_01_0017__section8647175812179:

Terminating a Job
-----------------

On the **SQL Jobs** page, you can click **Terminate** in the **Operation** column to stop a submitting or running job.

.. _dli_01_0017__section1152211221244:

Exporting Query Results
-----------------------

A maximum of 1000 records can be displayed in the query result on the console. To view more or all data, you can export the data to OBS. The procedure is as follows:

You can export results on the **SQL Jobs** page or the **SQL Editor** page.

-  On the **Job Management** > **SQL Jobs** page, you can click **More** > **Export Result** in the **Operation** column to export the query result.
-  After the query statements are successfully executed on the **SQL Editor** page, click |image3| on the right of the **View Result** tab page to export the query result.

.. note::

   If no column of the numeric type is displayed in the query result, the result cannot be exported.

.. table:: **Table 2** Exporting parameters

   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter                         | Description                                                                                                                                                             |
   +===================================+=========================================================================================================================================================================+
   | Data Format                       | Format of the exported query result file. This parameter can be set to **json** or **csv**.                                                                             |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | **Queues**                        | The queue where the jobs are executed. SQL jobs can be executed only in SQL queues. For details about how to create a queue, see :ref:`Creating a Queue <dli_01_0363>`. |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | **Compression Format**            | Compression format of the data to be exported. The following options are supported:                                                                                     |
   |                                   |                                                                                                                                                                         |
   |                                   | -  none                                                                                                                                                                 |
   |                                   | -  bzip2                                                                                                                                                                |
   |                                   | -  deflate                                                                                                                                                              |
   |                                   | -  gzip                                                                                                                                                                 |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | **Storage Path**                  | OBS path to store the result.                                                                                                                                           |
   |                                   |                                                                                                                                                                         |
   |                                   | .. note::                                                                                                                                                               |
   |                                   |                                                                                                                                                                         |
   |                                   |    -  After selecting an OBS bucket, enter a name for the folder. If the folder does not exist, it will be created in OBS.                                              |
   |                                   |    -  The folder name cannot contain the special characters of \\ / : \* ? "< > \|, and cannot start or end with a dot (.).                                             |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | **Export Mode**                   | Mode for saving the exported query result data.                                                                                                                         |
   |                                   |                                                                                                                                                                         |
   |                                   | -  **New OBS directory**: If the specified export directory exists, an error is reported and the export operation cannot be performed.                                  |
   |                                   | -  **Existing OBS directory (Overwritten)**: If you create a file in the specified directory, the existing file will be overwritten.                                    |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | **Number of Results**             | Number of exported query results. If no value is entered or the value is **0**, all results are exported.                                                               |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | **Table Header**                  | Whether the data to be exported contains table headers.                                                                                                                 |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. |image1| image:: /_static/images/en-us_image_0000001209671182.png
.. |image2| image:: /_static/images/en-us_image_0206789824.png
.. |image3| image:: /_static/images/en-us_image_0000001209516352.png
